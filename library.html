<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <!-- ==========================================
       META TAGS - SEO & Performance Optimized
       Standards: Google Lighthouse + Core Web Vitals
       ========================================== -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  <!-- SEO Meta Tags -->
  <meta name="description" content="منصة أثر التعليمية - مكتبتك الرقمية للمحاضرات والمواد الدراسية" />
  <meta name="keywords" content="تعليم، محاضرات، مكتبة رقمية، أثر، دروس أونلاين" />
  <meta name="author" content="منصة أثر التعليمية" />
  <meta name="robots" content="index, follow" />
  
  <!-- Theme & PWA -->
  <meta name="theme-color" content="#16a34a" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="أثر" />
  
  <!-- Open Graph - Social Media -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="المكتبة - منصة أثر التعليمية" />
  <meta property="og:description" content="مكتبتك الرقمية للمحاضرات والمواد الدراسية" />
  <meta property="og:image" content="/assets/og-image.jpg" />
  <meta property="og:url" content="https://athr.education/library.html" />
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="المكتبة - منصة أثر" />
  <meta name="twitter:description" content="مكتبتك الرقمية للمحاضرات" />
  
  <title>المكتبة - منصة أثر التعليمية</title>

  <!-- ==========================================
       PRECONNECT - Performance Optimization
       ========================================== -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin />
  <link rel="dns-prefetch" href="https://unpkg.com" />

  <!-- ==========================================
       FONTS - Google Fonts (Arabic)
       Standard: Variable Fonts for Performance
       ========================================== -->
  <link 
    href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800;900&family=IBM+Plex+Sans+Arabic:wght@400;500;600;700&display=swap" 
    rel="stylesheet" 
  />

  <!-- ==========================================
       ICONS - Font Awesome 6
       ========================================== -->
  <link 
    rel="stylesheet" 
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" 
    integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" 
    crossorigin="anonymous" 
    referrerpolicy="no-referrer" 
  />

  <!-- ==========================================
       STYLESHEETS - Glass Morphism Design
       ========================================== -->
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="css/platform.css" />
  <link rel="stylesheet" href="css/auth.css" />

  <!-- ==========================================
       PWA MANIFEST
       ========================================== -->
  <link rel="manifest" href="/manifest.json" />

  <!-- ==========================================
       FAVICONS
       ========================================== -->
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />

  <!-- ==========================================
       AOS ANIMATION LIBRARY
       ========================================== -->
  <link 
    href="https://unpkg.com/aos@2.3.1/dist/aos.css" 
    rel="stylesheet" 
  />

  <!-- ==========================================
       INLINE SVG GRADIENTS - Performance
       ========================================== -->
  <svg width="0" height="0" style="position:absolute" aria-hidden="true">
    <defs>
      <!-- Progress Gradient - Apple Watch Style -->
      <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="0%">
        <stop offset="0%" stop-color="#10b981" />
        <stop offset="100%" stop-color="#22c55e" />
      </linearGradient>
      
      <!-- Glow Effect -->
      <filter id="glow">
        <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
        <feMerge>
          <feMergeNode in="coloredBlur"/>
          <feMergeNode in="SourceGraphic"/>
        </feMerge>
      </filter>
    </defs>
  </svg>

  <!-- ==========================================
       CRITICAL CSS - Inline for Performance
       ========================================== -->
  <style>
    /* Loading Screen - Prevent FOUC */
    body:not(.loaded) {
      overflow: hidden;
    }
    
    body:not(.loaded)::before {
      content: '';
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, #16a34a 0%, #10b981 100%);
      z-index: 99999;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    body:not(.loaded)::after {
      content: '';
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 50px;
      height: 50px;
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      z-index: 999999;
    }
    
    @keyframes spin {
      to { transform: translate(-50%, -50%) rotate(360deg); }
    }
  </style>
</head>

<body role="application" aria-label="تطبيق المكتبة - منصة أثر التعليمية">
  <!-- ==========================================
       BACKGROUND WAVES - Decorative
       ========================================== -->
  <div class="background-waves" aria-hidden="true">
    <div class="wave-layer"></div>
    <div class="wave-layer"></div>
    <div class="wave-layer"></div>
  </div>

  <!-- ==========================================
       SKIP TO CONTENT LINK - Accessibility
       Standard: WCAG 2.1 AA Compliant
       ========================================== -->
  <a href="#main-content" class="skip-to-content">
    الانتقال إلى المحتوى الرئيسي
  </a>

  <!-- ==========================================
       TOAST CONTAINER - Pre-rendered
       ✅ NEW: Added for library.js V28.0
       ========================================== -->
  <div 
    class="toast-container" 
    data-singleton="true"
    role="region" 
    aria-label="الإشعارات" 
    aria-live="polite"></div>

  <!-- ==========================================
       PROFILE MODAL - ENHANCED V3.0 ULTIMATE
       ✅ All Events Connected + Rounded Design
       ========================================== -->
  <div 
    class="profile-modal" 
    id="profileModal" 
    role="dialog" 
    aria-modal="true" 
    aria-labelledby="profileModalTitle" 
    aria-hidden="true"
    tabindex="-1">
    
    <!-- Backdrop - Click to Close -->
    <div 
      class="profile-modal-overlay" 
      onclick="window.closeProfile()"
      aria-label="إغلاق"></div>
    
    <!-- Modal Content -->
    <div class="profile-modal-content" role="document">
      <!-- Close Button -->
      <button 
        class="profile-close" 
        onclick="window.closeProfile()"
        aria-label="إغلاق الملف الشخصي"
        type="button">
        <i class="fas fa-times" aria-hidden="true"></i>
      </button>
      
      <!-- Header -->
      <header class="profile-header">
        <h2 id="profileModalTitle">
          <i class="fas fa-user-circle" aria-hidden="true"></i>
          الملف الشخصي
        </h2>
        <p>إدارة معلوماتك الشخصية</p>
      </header>

      <!-- Body -->
      <div class="profile-body">
        <!-- Avatar Section -->
        <div class="profile-avatar-section" aria-label="إعدادات الصورة الرمزية">
          <div class="profile-avatar-wrapper">
            <img 
              id="profileAvatarImg" 
              alt="صورة المستخدم" 
              class="profile-avatar-img"
              loading="lazy"
            />
            <button 
              class="change-avatar-btn" 
              onclick="window.showAvatarSelector()"
              aria-label="تغيير الصورة الرمزية"
              type="button">
              <i class="fas fa-camera" aria-hidden="true"></i>
            </button>
          </div>
          
          <div style="text-align: center; margin-top: 16px;">
            <h3 id="profileModalName" style="font-size: 1.1rem; font-weight: 700; margin: 0 0 4px 0; color: var(--text-primary);">
              المستخدم
            </h3>
          </div>
        </div>
        
        <!-- Form -->
        <form id="profileForm" onsubmit="return false;">
          <!-- Name Field -->
          <div class="form-group">
            <label for="profileName" class="form-label">
              <i class="fas fa-user" aria-hidden="true"></i> الاسم الكامل
            </label>
            <input 
              id="profileName" 
              type="text" 
              class="form-input" 
              autocomplete="name"
              required
              aria-required="true"
              placeholder="أدخل اسمك الكامل"
            />
          </div>
          
          <!-- Username Field -->
          <div class="form-group">
            <label for="profileUsername" class="form-label">
              <i class="fas fa-at" aria-hidden="true"></i> اسم المستخدم
            </label>
            <input 
              id="profileUsername" 
              type="text" 
              class="form-input" 
              autocomplete="username"
              placeholder="حروف وأرقام و _ فقط"
              style="direction: ltr;"
            />
          </div>
          
          <!-- Phone Field -->
          <div class="form-group">
            <label for="profilePhone" class="form-label">
              <i class="fas fa-phone" aria-hidden="true"></i> رقم الهاتف
            </label>
            <input 
              id="profilePhone" 
              type="tel" 
              class="form-input" 
              autocomplete="tel"
              placeholder="اختياري"
              style="direction: ltr;"
            />
          </div>
          
          <!-- Email Field (Disabled) -->
          <div class="form-group">
            <label for="profileEmail" class="form-label">
              <i class="fas fa-envelope" aria-hidden="true"></i> البريد الإلكتروني
            </label>
            <input 
              id="profileEmail" 
              type="email" 
              class="form-input" 
              disabled 
              readonly
              aria-disabled="true"
            />
            <p style="font-size: 0.8rem; color: #64748b; margin-top: 6px; display: flex; align-items: center; gap: 6px;">
              <i class="fas fa-info-circle" aria-hidden="true"></i> البريد الإلكتروني لا يمكن تغييره
            </p>
          </div>
          
          <!-- Password Field -->
          <div class="form-group">
            <label for="profilePassword" class="form-label">
              <i class="fas fa-lock" aria-hidden="true"></i> كلمة مرور جديدة
            </label>
            <input 
              id="profilePassword" 
              type="password" 
              class="form-input" 
              placeholder="اتركها فارغة إذا لم تريد التغيير" 
              minlength="6" 
              autocomplete="new-password"
              aria-describedby="password-help"
              style="direction: ltr;"
            />
            <p id="password-help" style="font-size: 0.8rem; color: #64748b; margin-top: 6px; display: flex; align-items: center; gap: 6px;">
              <i class="fas fa-shield-alt" aria-hidden="true"></i> 6 أحرف على الأقل
            </p>
          </div>
        </form>
      </div>

      <!-- Footer Actions -->
      <footer class="profile-actions">
        <button 
          type="button" 
          class="profile-btn profile-btn-secondary" 
          onclick="window.logout()">
          <i class="fas fa-sign-out-alt" aria-hidden="true"></i>
          <span>تسجيل الخروج</span>
        </button>
        
        <button 
          type="button" 
          id="saveProfileBtn" 
          class="profile-btn profile-btn-primary">
          <i class="fas fa-check-circle" aria-hidden="true"></i>
          <span>حفظ التعديلات</span>
        </button>
      </footer>
    </div>
  </div>

  <!-- ==========================================
       AVATAR SELECTOR MODAL - Dark Mode Ready
       ========================================== -->
  <div 
    id="avatarSelector" 
    style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(20px); z-index: 100001; align-items: center; justify-content: center; padding: 20px;">
    <div style="background: var(--glass-bg-strong); backdrop-filter: blur(30px); border: 2px solid var(--glass-border); border-radius: 28px; max-width: 520px; width: 100%; padding: 36px; position: relative; box-shadow: 0 24px 64px rgba(0, 0, 0, 0.3); transition: background 0.3s, border-color 0.3s;">
      <!-- Close Button -->
      <button 
        onclick="window.closeAvatarSelector()" 
        style="position: absolute; top: 20px; left: 20px; width: 44px; height: 44px; border-radius: 50%; background: rgba(255, 255, 255, 0.6); border: 2px solid rgba(203, 213, 225, 0.3); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.3s;"
        aria-label="إغلاق"
        type="button">
        <i class="fas fa-times" style="color: #64748b; font-size: 18px;"></i>
      </button>
      
      <!-- Title -->
      <h3 style="text-align: center; margin: 0 0 28px 0; color: var(--text-heading); font-size: 1.65rem; font-weight: 800; line-height: 1.2;">
        <i class="fas fa-images" style="color: var(--color-primary);"></i>
        اختر صورة رمزية
      </h3>
      
      <!-- Avatars Grid -->
      <div class="avatars-grid"></div>
      
      <!-- Actions -->
      <div style="display: flex; gap: 14px; margin-top: 28px;">
        <button 
          onclick="window.cancelAvatarSelection()" 
          class="profile-btn profile-btn-secondary" 
          style="flex: 1;"
          type="button">
          <i class="fas fa-times"></i>
          إلغاء
        </button>
        <button 
          onclick="window.confirmAvatarSelection()" 
          class="profile-btn profile-btn-primary" 
          style="flex: 1;"
          type="button">
          <i class="fas fa-check"></i>
          تأكيد
        </button>
      </div>
    </div>
  </div>

  <!-- ==========================================
       HEADER - Sticky Navigation
       Standard: iOS Navigation Bar (64px)
       ========================================== -->
  <header class="platform-header" role="banner">
    <div class="header-content">
      <!-- Logo -->
      <a href="index.html" class="platform-logo" aria-label="الصفحة الرئيسية">
        <i class="fas fa-graduation-cap" aria-hidden="true"></i>
      </a>

      <!-- User Section (Right Side) -->
      <button 
        class="user-section loading" 
        aria-label="فتح الملف الشخصي"
        aria-haspopup="dialog"
        type="button">
        <div class="user-avatar-header">
          <img 
            id="headerUserAvatar" 
            alt="صورة المستخدم"
            loading="lazy"
          />
        </div>
        <div class="user-info">
          <h3 id="headerUserName">المستخدم</h3>
          <p id="headerUserUniversity">طالب</p>
        </div>
        <i class="fas fa-angle-down" id="userMenuIcon" aria-hidden="true"></i>
      </button>
    </div>
  </header>

  <!-- ==========================================
       MAIN CONTENT
       ========================================== -->
  <main class="platform-container" role="main" id="main-content">
    <!-- Welcome Card - Dashboard Hero -->
    <section 
      class="welcome-card-new" 
      data-aos="fade-down"
      aria-label="لوحة المعلومات">
      <div>
        <h1>مرحباً بك</h1>
        <p>اختر محاضرة لبدء الدراسة</p>

        <!-- Smart Greeting -->
        <div id="smartGreeting" class="smart-greeting" style="display:none;">
          <div style="flex:1">
            <h3 
              id="greetHeadline" 
              style="font-size:1.2rem; font-weight:800; margin:0 0 4px 0; color:var(--text-primary);">
              مرحباً
            </h3>
            <p 
              id="greetSub" 
              style="color:var(--text-secondary); font-weight:600; margin:0; font-size:0.95rem;">
              جاهز تبدأ؟
            </p>
          </div>
          <button 
            id="greetContinueBtn" 
            class="capsule-btn" 
            style="display:none; white-space:nowrap; flex-shrink:0; padding: 10px 16px;"
            type="button">
            <i class="fas fa-play" aria-hidden="true"></i> متابعة
          </button>
        </div>

        <!-- Overall Progress Bar -->
        <div class="progress-bar-minimal" style="margin-top:20px;">
          <small style="color:var(--text-secondary); font-weight:600;">التقدم العام</small>
          <div 
            class="subject-card-progressbar" 
            style="margin-top:8px; height:8px;"
            role="progressbar"
            aria-label="التقدم العام"
            aria-valuenow="0"
            aria-valuemin="0"
            aria-valuemax="100">
            <div 
              id="overallProgressFill" 
              class="subject-card-progressbar-fill" 
              style="width:0%; background: linear-gradient(135deg,#10b981,#22c55e); border-radius:999px"></div>
          </div>
          <div style="margin-top:4px; font-size:0.85rem; color:var(--text-secondary);">
            <span id="progressText" aria-live="polite">0/0 محاضرة</span>
          </div>
        </div>
      </div>

      <!-- Progress Circle - Apple Watch Style - ✅ FIXED -->
      <div class="welcome-icon-wrapper" aria-hidden="true">
        <div class="stat-card-progress-circle">
          <svg class="progress-svg" viewBox="0 0 120 120">
            <circle class="progress-bg" cx="60" cy="60" r="54" stroke-width="8"></circle>
            <circle 
              class="progress-bar" 
              id="userProgressCircle" 
              cx="60" 
              cy="60" 
              r="54" 
              stroke-width="8" 
              stroke-dasharray="339.29" 
              stroke-dashoffset="339.29"></circle>
          </svg>
          <div class="progress-text">
            <span id="userProgressPercentage">0%</span>
          </div>
        </div>
      </div>
    </section>

    <!-- ==========================================
         TABS - iOS Segmented Control - ✅ FIXED
         ========================================== -->
    <nav 
      class="filter-tabs-container" 
      data-aos="fade-up" 
      data-aos-delay="200"
      role="tablist"
      aria-label="التنقل بين الأقسام">
      <div class="tabs-new">
        <button 
          class="tab-btn-new active" 
          data-tab="allSubjects" 
          role="tab"
          aria-selected="true"
          aria-controls="allSubjects"
          id="tab-allSubjects"
          type="button"
          onclick="window.switchTab('allSubjects')">
          <i class="fas fa-th-large" aria-hidden="true"></i> 
          <span>المواد</span>
        </button>

        <button 
          class="tab-btn-new" 
          data-tab="myLibrary" 
          role="tab"
          aria-selected="false"
          aria-controls="myLibrary"
          id="tab-myLibrary"
          type="button"
          onclick="window.switchTab('myLibrary')">
          <i class="fas fa-book" aria-hidden="true"></i> 
          <span>مكتبتي (<span id="headerLibraryCount" aria-live="polite">0</span>)</span>
        </button>

        <button 
          class="tab-btn-new" 
          data-tab="continueWatching" 
          style="display:none;" 
          role="tab"
          aria-selected="false"
          aria-controls="continueWatching"
          id="tab-continueWatching"
          type="button"
          onclick="window.switchTab('continueWatching')">
          <i class="fas fa-play-circle" aria-hidden="true"></i> 
          <span>متابعة <span class="cw-badge" id="cwCount"></span></span>
        </button>
      </div>
    </nav>

    <!-- ==========================================
         TAB PANELS
         ========================================== -->
    <div class="tab-content-container">
      <!-- All Subjects Panel -->
      <section 
        class="tab-panel-new active" 
        id="allSubjects"
        role="tabpanel"
        aria-labelledby="tab-allSubjects"
        tabindex="0">
        <div 
          id="subjectsGrid" 
          class="subjects-grid"
          role="list"
          aria-label="قائمة المواد"></div>
      </section>
      
      <!-- My Library Panel -->
      <section 
        class="tab-panel-new" 
        id="myLibrary"
        role="tabpanel"
        aria-labelledby="tab-myLibrary"
        aria-hidden="true"
        tabindex="0">
        
        <!-- Empty State - ✅ FIXED -->
        <div 
          id="libraryEmptyState" 
          class="library-empty-state" 
          style="display:none;"
          role="status">
          <i class="fas fa-book-open" aria-hidden="true"></i>
          <h3>مكتبتك فارغة</h3>
          <p style="color:var(--text-secondary);margin:0 0 20px;">
            ابدأ بتفعيل محاضرة أو اختر من المواد المجانية
          </p>
          <button 
            class="browse-btn-new" 
            type="button"
            onclick="window.switchTab('allSubjects')">
            تصفح المواد
          </button>
        </div>
        
        <!-- Modern Library Container -->
        <div class="modern-library-container">
          <header class="modern-library-header">
            <div>
              <h2>مكتبتي</h2>
              <p>
                <span id="myLibraryCount" aria-live="polite">0</span> مادة - 
                <span id="myLibraryLecturesCount" aria-live="polite">0</span> محاضرة
              </p>
            </div>

            <!-- View Controls - ✅ FIXED -->
            <div 
              class="library-view-controls" 
              role="radiogroup"
              aria-label="نوع العرض">
              <button 
                class="view-control-btn active" 
                data-view="grid" 
                aria-label="عرض شبكي"
                aria-pressed="true"
                role="radio"
                type="button"
                onclick="window.setLibraryView('grid')">
                <i class="fas fa-th" aria-hidden="true"></i>
              </button>
              <button 
                class="view-control-btn" 
                data-view="list" 
                aria-label="عرض قائمة"
                aria-pressed="false"
                role="radio"
                type="button"
                onclick="window.setLibraryView('list')">
                <i class="fas fa-list" aria-hidden="true"></i>
              </button>
            </div>
          </header>
          
          <div 
            id="myLibraryGrid" 
            class="modern-library-grid"
            role="list"
            aria-label="مكتبتي"></div>
        </div>
      </section>
      
      <!-- Continue Watching Panel -->
      <section 
        class="tab-panel-new" 
        id="continueWatching"
        role="tabpanel"
        aria-labelledby="tab-continueWatching"
        aria-hidden="true"
        tabindex="0">
        <div 
          id="continueWatchingGrid"
          role="list"
          aria-label="متابعة المشاهدة"></div>
      </section>
    </div>

    <!-- ==========================================
         LECTURES VIEW (Hidden by Default) - ✅ FIXED
         ========================================== -->
    <section 
      id="lecturesView" 
      style="display:none;"
      aria-label="عرض المحاضرات">
      <header class="lectures-view-header">
        <button 
          class="back-button" 
          aria-label="العودة للمكتبة"
          type="button"
          onclick="window.backToLibrary()">
          <i class="fas fa-arrow-right" aria-hidden="true"></i> عودة
        </button>
        <h2 id="subjectTitle">المحاضرات</h2>
      </header>
      <div 
        id="lecturesList" 
        class="lectures-list-new"
        role="list"></div>
    </section>
  </main>

  <!-- ==========================================
       THEME TOGGLE BUTTON - Dark Mode
       ✅ Glass Morphism Toggle
       ========================================== -->
  <button 
    class="theme-toggle-btn" 
    id="themeToggleBtn"
    aria-label="تبديل الوضع المظلم"
    aria-pressed="false"
    type="button">
    <i class="fas fa-sun" aria-hidden="true"></i>
    <i class="fas fa-moon" aria-hidden="true"></i>
  </button>

  <!-- ==========================================
       SCRIPTS
       ========================================== -->
  
  <!-- Theme Toggle Script -->
  <script>
    // ==========================================
    // THEME TOGGLE FUNCTIONALITY
    // Unified with platform.css + style.css
    // ==========================================
    (function() {
      const themeToggleBtn = document.getElementById('themeToggleBtn');
      const currentTheme = localStorage.getItem('athr-theme') || 'light';
      
      // Apply saved theme on load
      if (currentTheme === 'dark') {
        document.body.classList.add('dark-mode');
        if (themeToggleBtn) {
          themeToggleBtn.setAttribute('aria-pressed', 'true');
        }
      }
      
      // Toggle theme function
      function toggleTheme() {
        const isDark = document.body.classList.toggle('dark-mode');
        const newTheme = isDark ? 'dark' : 'light';
        
        // Save preference
        localStorage.setItem('athr-theme', newTheme);
        
        // Update button state
        if (themeToggleBtn) {
          themeToggleBtn.setAttribute('aria-pressed', isDark);
        }
        
        // Dispatch custom event for library.js integration
        window.dispatchEvent(new CustomEvent('themechange', {
          detail: { theme: newTheme }
        }));
        
        // Announce to screen readers
        const announcement = document.createElement('div');
        announcement.setAttribute('role', 'status');
        announcement.setAttribute('aria-live', 'polite');
        announcement.className = 'sr-only';
        announcement.textContent = isDark ? 'تم التبديل إلى الوضع المظلم' : 'تم التبديل إلى الوضع المضيء';
        document.body.appendChild(announcement);
        
        setTimeout(() => announcement.remove(), 1000);
      }
      
      // Attach event listener
      if (themeToggleBtn) {
        themeToggleBtn.addEventListener('click', toggleTheme);
      }
      
      // Keyboard shortcut (Ctrl+Shift+D)
      document.addEventListener('keydown', (e) => {
        if (e.ctrlKey && e.shiftKey && e.key === 'D') {
          e.preventDefault();
          toggleTheme();
        }
      });
    })();
  </script>

  <!-- AOS Animation Library -->
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script>
    // Initialize AOS with Best Practices
    AOS.init({
      duration: 800,
      once: true,
      easing: 'ease-in-out',
      disable: 'mobile', // Disable on mobile for performance
      offset: 50,
      delay: 0,
    });
  </script>

  <!-- Main Application Script (ES6 Module) -->
  <script type="module" src="js/library.js"></script>
  <script type="module" src="js/app.js"></script>

  <!-- ==========================================
       PAGE LOAD COMPLETION
       ========================================== -->
  <script>
    // Remove Loading State
    window.addEventListener('load', () => {
      document.body.classList.add('loaded');
      
      // Announce to Screen Readers
      const announcement = document.createElement('div');
      announcement.setAttribute('role', 'status');
      announcement.setAttribute('aria-live', 'polite');
      announcement.className = 'sr-only';
      announcement.textContent = 'تم تحميل الصفحة بنجاح';
      document.body.appendChild(announcement);
      
      // Remove after announcement
      setTimeout(() => announcement.remove(), 1000);
    });

    // Service Worker Registration (PWA)
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(reg => console.log('✅ Service Worker registered'))
          .catch(err => console.log('❌ Service Worker registration failed'));
      });
    }
  </script>
</body>
</html>
